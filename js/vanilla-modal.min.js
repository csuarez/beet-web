/**
 * @name vanilla-modal
 * @version 1.2.2
 * @author Ben Ceglowski
 * @url http://phuse.ca
 * @date 2015-11-23
 * @license MIT
 */;"use strict";!function(a,b){if("function"==typeof define&&define.amd)define(["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.vanillaModal=c.exports}}(this,function(a){function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();a.VanillaModal=function(){function a(c){b(this,a),this.$$={modal:".modal",modalInner:".modal-inner",modalContent:".modal-content",open:'[rel="modal:open"]',close:'[rel="modal:close"]',page:"body","class":"modal-visible",loadClass:"vanilla-modal",clickOutside:!0,closeKey:27,transitions:!0,transitionEnd:null,onBeforeOpen:function(){},onBeforeClose:function(){},onOpen:function(){},onClose:function(){}},this._applyUserSettings(c),this.error=!1,this.isOpen=!1,this.current=null,this.open=this._open.bind(this),this.close=this._close.bind(this),this.$$.transitionEnd=this._transitionEndVendorSniff(),this.$=this._setupDomNodes(),this.error?console.error("Please fix errors before proceeding."):(this._addLoadedCssClass(),this._events().add())}return c(a,[{key:"_applyUserSettings",value:function(a){if("object"==typeof a)for(var b in a)a.hasOwnProperty(b)&&(this.$$[b]=a[b])}},{key:"_transitionEndVendorSniff",value:function(){if(this.$$.transitions!==!1){var a=document.createElement("div"),b={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var c in b)if(b.hasOwnProperty(c)&&void 0!==a.style[c])return b[c]}}},{key:"_getNode",value:function(a,b){var c=b||document,d=c.querySelector(a);return d?d:(this.error=!0,console.error(a+" not found in document."))}},{key:"_setupDomNodes",value:function(){var a={};return a.modal=this._getNode(this.$$.modal),a.page=this._getNode(this.$$.page),a.modalInner=this._getNode(this.$$.modalInner,this.modal),a.modalContent=this._getNode(this.$$.modalContent,this.modal),a}},{key:"_addLoadedCssClass",value:function(){this._addClass(this.$.page,this.$$.loadClass)}},{key:"_addClass",value:function(a,b){if(a instanceof HTMLElement!=!1){var c=a.className.split(" ");-1===c.indexOf(b)&&c.push(b),a.className=c.join(" ")}}},{key:"_removeClass",value:function(a,b){if(a instanceof HTMLElement!=!1){var c=a.className.split(" ");c.indexOf(b)>-1&&c.splice(c.indexOf(b),1),a.className=c.join(" ")}}},{key:"_setOpenId",value:function(){var a=this.current.id||"anonymous";this.$.page.setAttribute("data-current-modal",a)}},{key:"_removeOpenId",value:function(){this.$.page.removeAttribute("data-current-modal")}},{key:"_getElementContext",value:function(a){return a&&"string"==typeof a.hash?document.querySelector(a.hash):"string"==typeof a?document.querySelector(a):console.error("No selector supplied to open()")}},{key:"_open",value:function(a){return this._releaseNode(),this.current=this._getElementContext(a),this.current instanceof HTMLElement==!1?console.error("VanillaModal target must exist on page."):("function"==typeof this.$$.onBeforeOpen&&this.$$.onBeforeOpen.call(this),this._captureNode(),this._addClass(this.$.page,this.$$["class"]),this._setOpenId(),this.isOpen=!0,void("function"==typeof this.$$.onOpen&&this.$$.onOpen.call(this)))}},{key:"_detectTransition",value:function(){var a=window.getComputedStyle(this.$.modal,null),b=["transitionDuration","oTransitionDuration","MozTransitionDuration","webkitTransitionDuration"],c=b.filter(function(b){return"string"==typeof a[b]&&parseFloat(a[b])>0?!0:void 0});return c.length?!0:!1}},{key:"_close",value:function(a){if(this.isOpen===!0){this.isOpen=!1,"function"==typeof this.$$.onBeforeClose&&this.$$.onBeforeClose.call(this),this._removeClass(this.$.page,this.$$["class"]);var b=this._detectTransition();this.$$.transitions&&this.$$.transitionEnd&&b?this._closeModalWithTransition():this._closeModal()}}},{key:"_closeModal",value:function(){this._removeOpenId(this.$.page),this._releaseNode(),this.isOpen=!1,this.current=null,"function"==typeof this.$$.onClose&&this.$$.onClose.call(this)}},{key:"_closeModalWithTransition",value:function(){var a=function(){this.$.modal.removeEventListener(this.$$.transitionEnd,a),this._closeModal()}.bind(this);this.$.modal.addEventListener(this.$$.transitionEnd,a)}},{key:"_captureNode",value:function(){if(this.current)for(;this.current.childNodes.length>0;)this.$.modalContent.appendChild(this.current.childNodes[0])}},{key:"_releaseNode",value:function(){if(this.current)for(;this.$.modalContent.childNodes.length>0;)this.current.appendChild(this.$.modalContent.childNodes[0])}},{key:"_closeKeyHandler",value:function(a){"number"==typeof this.$$.closeKey&&a.which===this.$$.closeKey&&this.isOpen===!0&&(a.preventDefault(),this.close())}},{key:"_outsideClickHandler",value:function(a){if(this.$$.clickOutside===!0){for(var b=a.target;b&&b!=document.body;){if(b===this.$.modalInner)return;b=b.parentNode}this.close()}}},{key:"_matches",value:function(a,b){for(var c=a.target,d=(c.document||c.ownerDocument).querySelectorAll(b),e=0;e<d.length;e++)for(var f=c;f&&f!==document.body;){if(f===d[e])return f;f=f.parentNode}return null}},{key:"_delegateOpen",value:function(a){var b=this._matches(a,this.$$.open);return b?(a.preventDefault(),this.open(b)):void 0}},{key:"_delegateClose",value:function(a){return this._matches(a,this.$$.close)?(a.preventDefault(),this.close()):void 0}},{key:"_events",value:function(){var a=this._closeKeyHandler.bind(this),b=this._outsideClickHandler.bind(this),c=this._delegateOpen.bind(this),d=this._delegateClose.bind(this),e=function(){this.$.modal.addEventListener("click",b),document.addEventListener("keydown",a),document.addEventListener("click",c),document.addEventListener("click",d)};return this.destroy=function(){this.close(),this.$.modal.removeEventListener("click",b),document.removeEventListener("keydown",a),document.removeEventListener("click",c),document.removeEventListener("click",d)},{add:e.bind(this)}}}]),a}()});